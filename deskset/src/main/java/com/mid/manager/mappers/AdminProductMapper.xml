<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mid.manager.repo.AdminProductDAO">
	
	
	
	<!-- 카테고리 리스트 불러오기 -->	
	<select id="getCategoryListAD" resultType="com.mid.manager.model.CategoryVO">
		SELECT *
		FROM CATEGORY
	</select>
	
	<!-- 상품등록 페이지 카테고리 별 속성 리스트 불러오기 -->
	
	<select id="getcategoryATTR" parameterType="String" resultType="com.mid.manager.model.RegistProductVO">
		SELECT 
			c.cate_id,
			a.attr_id,
			a.attr_name
		FROM ATTR a
		LEFT JOIN CATEGORY c ON a.cate_id = c.cate_id
		WHERE c.cate_name = #{selectedCategory}
	</select>
	
	<!-- 제품 리스트 불러오기 -->
	<select id="getProductListAD" resultType="com.mid.manager.model.ProductCAJoinVO">
		SELECT
			p.product_no,
			c.cate_name,
			a.admin_name,
			p.product_name,
			p.product_mfc,
			p.product_price,
			p.product_stock,
			p.product_image,
			p.product_thum,
			p.product_cont
		FROM PRODUCT p
		LEFT JOIN CATEGORY c ON p.cate_id = c.cate_id
		LEFT JOIN ADMIN a ON p.admin_no = a.admin_no
	</select> 




	<!-- 카테고리명으로 카테고리 ID 조회 -->
	<select id="getCategoryIdByName" parameterType="String" resultType="String">
	    SELECT cate_id 
	    FROM CATEGORY 
	    WHERE cate_name = #{categoryName}
	</select>
	
	<!-- 상품 등록 (트리거가 자동으로 PRODUCT_NO 생성) -->
	<insert id="insertProduct" parameterType="com.mid.manager.model.RegistProductDTO">
	    INSERT INTO PRODUCT (
	        cate_id,
	        admin_no,
	        product_name,
	        product_mfc,
	        product_price,
	        product_stock,
	        product_image,
	        product_thum,
	        product_cont,
	        product_regdate
	    ) VALUES (
	        #{cate_id},
	        #{admin_no},
	        #{product_name},
	        #{product_mfc},
	        #{product_price},
	        #{product_stock},
	        #{product_image},
	        #{product_thum},
	        #{product_cont},
	        SYSDATE
	    )
	</insert>
	
	<!-- 최근 등록된 상품 번호 조회 (해당 카테고리의 가장 최근 등록 상품) -->
	<select id="getLastInsertedProductNo" parameterType="String" resultType="String">
	    SELECT product_no 
	    FROM (
	        SELECT product_no 
	        FROM PRODUCT 
	        WHERE cate_id = #{categoryId}
	        ORDER BY product_regdate DESC, product_no DESC
	    )
	    WHERE ROWNUM = 1
	</select>
	
	<!-- 속성값 저장 -->
	<insert id="insertAttrValue" parameterType="com.mid.manager.model.AttrValueDTO">
	    INSERT INTO ATTR_VALUE (
	        product_no,
	        attr_id,
	        attr_value
	    ) VALUES (
	        #{product_no},
	        #{attr_id},
	        #{attr_value}
	    )
	</insert>















</mapper>
<!-- 		SELECT 
			p.product_no,
			p.admin_no,
			p.product_name,
			p.product_mfc,
			p.product_price,
			p.product_stock,
			p.product_image,
			p.product_thum,
			p.product_cont,
			c.cate_id,
			c.cate_name,
			c.pn_prefix,
			at.attr_id,
			at.attr_name,
			atv.attr_value
		FROM PRODUCT p
		LEFT JOIN CATEGORY c ON p.cate_id = c.cate_id
		LEFT JOIN ADMIN ad ON p.admin_no = ad.admin_no
		LEFT JOIN ATTR_VALUE atv ON p.product_no = atv.product_no
		LEFT JOIN ATTR at ON atv.attr_id = at.attr_id
		WHERE c.cate_name = #{selectedCategory} -->