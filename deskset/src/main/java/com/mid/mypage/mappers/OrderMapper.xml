<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mid.mypage.mapper.OrderMapper">
    <!-- 회원의 주문 목록을 조회 -->
    <select id="getOrderList" parameterType="String" resultType="com.mid.mypage.model.OrderVO">
        SELECT 
            o.order_no as orderNo,
            o.mem_no as memNo,
            o.pay_no as payNo,
            o.coupon_id as couponId,
            o.order_date as orderDate,
            o.delivery_fee as deliveryFee,
            o.order_status as orderStatus,
            p.product_name as productName,
            p.product_price as productPrice
        FROM ORDERS o
        JOIN ORDERS_DETAIL od ON o.order_no = od.order_no
        JOIN PRODUCT p ON od.product_no = p.product_no
        WHERE o.mem_no = #{memNo}
        ORDER BY o.order_date DESC
    </select>

    <!-- 주문 번호로 주문 정보를 조회 -->
    <select id="getOrder" parameterType="String" resultType="com.mid.mypage.model.OrderVO">
        SELECT 
            o.order_no as orderNo,
            o.mem_no as memNo,
            o.pay_no as payNo,
            o.coupon_id as couponId,
            o.order_date as orderDate,
            o.delivery_fee as deliveryFee,
            o.order_status as orderStatus,
            p.product_name as productName,
            p.product_price as productPrice
        FROM ORDERS o
        JOIN ORDERS_DETAIL od ON o.order_no = od.order_no
        JOIN PRODUCT p ON od.product_no = p.product_no
        WHERE o.order_no = #{orderNo}
    </select>

    <!-- 새로운 주문을 등록 -->
    <insert id="insertOrder" parameterType="com.mid.mypage.model.OrderVO">
        INSERT INTO ORDERS (
            order_no, mem_no, pay_no, coupon_id,
            order_date, delivery_fee, order_status
        ) VALUES (
            #{orderNo}, #{memNo}, #{payNo}, #{couponId},
            SYSDATE, #{deliveryFee}, #{orderStatus}
        )
    </insert>

    <!-- 주문 상태를 업데이트 -->
    <update id="updateOrderStatus" parameterType="com.mid.mypage.model.OrderVO">
        UPDATE ORDERS 
        SET order_status = #{orderStatus}
        WHERE order_no = #{orderNo}
    </update>

    <!-- 회원 ID로 주문 목록을 조회 -->
    <select id="getOrderListByMemberId" parameterType="String" resultType="com.mid.mypage.model.OrderVO">
        SELECT 
            o.order_no as orderNo,
            o.mem_no as memNo,
            o.pay_no as payNo,
            o.coupon_id as couponId,
            o.order_date as orderDate,
            o.delivery_fee as deliveryFee,
            o.order_status as orderStatus,
            p.product_name as productName,
            p.product_price as productPrice
        FROM ORDERS o
        JOIN ORDERS_DETAIL od ON o.order_no = od.order_no
        JOIN PRODUCT p ON od.product_no = p.product_no
        JOIN MEMBER m ON o.mem_no = m.mem_no
        WHERE m.mem_id = #{memId}
        ORDER BY o.order_date DESC
    </select>
</mapper> 