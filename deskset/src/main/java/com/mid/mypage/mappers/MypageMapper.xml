<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mid.mypage.mapper.MypageMapper">
    <!-- 회원의 주문 목록 조회 -->
    <select id="getOrdersByMemNo" parameterType="String" resultType="com.mid.mypage.model.OrderVO">
        SELECT 
            o.order_no as orderNo,
            o.mem_no as memNo,
            o.pay_no as payNo,
            o.coupon_id as couponId,
            o.order_date as orderDate,
            o.delivery_fee as deliveryFee,
            o.order_status as orderStatus
        FROM ORDERS o
        WHERE o.mem_no = #{memNo}
        ORDER BY o.order_date DESC
    </select>

    <!-- 주문 상세 정보 조회 -->
    <select id="getOrderByOrderNo" parameterType="String" resultType="com.mid.mypage.model.OrderVO">
        SELECT 
            o.order_no as orderNo,
            o.mem_no as memNo,
            o.pay_no as payNo,
            o.coupon_id as couponId,
            o.order_date as orderDate,
            o.delivery_fee as deliveryFee,
            o.order_status as orderStatus
        FROM ORDERS o
        WHERE o.order_no = #{orderNo}
    </select>

    <!-- 최근 주문 목록 조회 -->
    <select id="getRecentOrders" resultType="com.mid.mypage.model.OrderVO">
        SELECT 
            o.order_no as orderNo,
            o.mem_no as memNo,
            o.pay_no as payNo,
            o.coupon_id as couponId,
            o.order_date as orderDate,
            o.delivery_fee as deliveryFee,
            o.order_status as orderStatus
        FROM ORDERS o
        WHERE o.mem_no = #{memNo}
        ORDER BY o.order_date DESC
        FETCH FIRST #{limit} ROWS ONLY
    </select>

    <!-- 회원의 장바구니 목록 조회 -->
    <select id="getCartItems" parameterType="String" resultType="com.mid.mypage.model.CartVO">
        SELECT 
            c.cart_id as cartId,
            c.mem_no as memNo,
            c.product_no as productNo,
            c.cart_quantity as cartQuantity
        FROM CART c
        WHERE c.mem_no = #{memNo}
    </select>

    <!-- 장바구니에 상품 추가 -->
    <insert id="insertCartItem" parameterType="com.mid.mypage.model.CartVO">
        INSERT INTO CART (cart_id, mem_no, product_no, cart_quantity)
        VALUES (#{cartId}, #{memNo}, #{productNo}, #{cartQuantity})
    </insert>

    <!-- 장바구니 상품 수량 수정 -->
    <update id="updateCartItemQuantity" parameterType="com.mid.mypage.model.CartVO">
        UPDATE CART 
        SET cart_quantity = #{cartQuantity}
        WHERE mem_no = #{memNo} AND product_no = #{productNo}
    </update>

    <!-- 장바구니 상품 삭제 -->
    <delete id="deleteCartItem">
        DELETE FROM CART 
        WHERE mem_no = #{memNo} AND product_no = #{productNo}
    </delete>

    <!-- 장바구니 전체 비우기 -->
    <delete id="deleteAllCartItems" parameterType="String">
        DELETE FROM CART WHERE mem_no = #{memNo}
    </delete>

    <!-- 장바구니 ID로 상품 삭제 -->
    <delete id="deleteCartItemById">
        DELETE FROM CART WHERE cart_id = #{cartId}
    </delete>

    <!-- 장바구니 ID로 상품 조회 -->
    <select id="getCartItemById" resultType="com.mid.mypage.model.CartVO">
        SELECT 
            cart_id as cartId,
            mem_no as memNo,
            product_no as productNo,
            cart_quantity as cartQuantity
        FROM CART
        WHERE cart_id = #{cartId}
    </select>

    <!-- 회원 정보 조회 -->
    <select id="getMemberInfo" parameterType="String" resultType="com.mid.mypage.model.MemberVO">
        SELECT * FROM MEMBER WHERE MEM_ID = #{memId}
    </select>

    <!-- 회원 정보 수정 -->
    <update id="updateMemberInfo" parameterType="com.mid.mypage.model.MemberVO">
        UPDATE MEMBER 
        SET MEM_NAME = #{memName},
            MEM_EMAIL = #{memEmail},
            MEM_PWD = #{memPwd},
            MEM_ADDR = #{memAddr},
            MEM_TEL = #{memTel}
        WHERE MEM_ID = #{memId}
    </update>

    <!-- 아이디 중복 체크 -->
    <select id="checkIdDuplicate" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM MEMBER WHERE MEM_ID = #{memId}
    </select>
</mapper> 